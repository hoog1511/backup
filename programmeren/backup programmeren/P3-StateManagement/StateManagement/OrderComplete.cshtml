@{
    Layout = "~/_Layout.cshtml";
    Page.Title = "Bedankt voor uw bestelling!";

    if (WebSecurity.IsAuthenticated)
    {
        if (Session["carChoice"] != null)
        {
            var db = Database.Open("DefaultConnection");

            // Maak ook maar een table aan als dat nog niet gebeurt is.. :(
            var exits = db.QuerySingle("SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME='Bestellingen'");
            if (exits == null)
            {
                db.Execute("CREATE TABLE Bestellingen (Id INT NOT NULL IDENTITY (1, 1), UserId int NOT NULL, Product VARCHAR(255) NOT NULL, Straat VARCHAR(255) NOT NULL, Huisnummer VARCHAR(255) NOT NULL, Plaats VARCHAR(255) NOT NULL) ON [PRIMARY]");
            }

            var insertCommand = "INSERT INTO Bestellingen (UserId, Product, Straat, Huisnummer, Plaats) VALUES(@0, @1, @2, @3, @4)";
            db.Execute(insertCommand, WebSecurity.CurrentUserId, Session["carChoice"], Session["street"], Session["number"], Session["location"]);
        }
    }
}
@if (WebSecurity.IsAuthenticated && Session["carChoice"] != null)
{
    @Html.ValidationSummary(true)
    <form method="post">
        <p>
            Welcome @WebSecurity.CurrentUserName!
            <a href="@Href("~/Logout.cshtml")">Uitloggen</a>
        </p>
        <fieldset>
            <legend>Bedankt voor uw bestelling!</legend>
            <p>
                Product: @Session["carChoice"]
            </p>

            <p>
                Straat: @Session["street"]
            </p>
            <p>
                Nummer: @Session["number"]
            </p>
            <p>
                Plaats: @Session["location"]
            </p>
            <p>
               <a href="@Href("~/AddProduct.cshtml")">Plaats nog een bestelling</a>
            </p>
        </fieldset>
    </form>
    {
        // Session leegmaken
        Session["carChoice"] = null;
        Session["street"] = null;
        Session["number"] = null;
        Session["location"] = null;
    }
}
else if (WebSecurity.IsAuthenticated && Session["carChoice"] == null)
{
    <p>
        Uw heeft geen bestelling geplaatst, plaats je bestelling <a href="@Href("~/AddProduct.cshtml")">hier</a>
    </p>
}
else
{
    <p>
        Gelieve <a href="@Href("~/Login.cshtml")">eerst in te loggen</a>
    </p>
}