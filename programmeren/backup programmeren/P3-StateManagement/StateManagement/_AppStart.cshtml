@using System.Data.SqlClient
@functions {

    public static void CreateSqlDatabaseIfNecessary(string path, string filename)
    {
        string location = Path.Combine(path, filename);
        if (!File.Exists(location))
        {
            var databaseName = Path.GetFileNameWithoutExtension(filename);
            using (var connection = new SqlConnection("Data Source=(LocalDB)\\MSSQLLocalDB;Initial Catalog=master;Integrated Security=true;"))
            {
                connection.Open();
                using (var command = connection.CreateCommand())
                {
                    command.CommandText = $"CREATE DATABASE {databaseName} ON PRIMARY (NAME={databaseName}, FILENAME='{location}')";
                    command.ExecuteNonQuery();

                    command.CommandText = $"EXEC sp_detach_db '{databaseName}', 'true'";
                    command.ExecuteNonQuery();
                }
            }
        }
    }
}
@{
    string path = Path.Combine(HttpRuntime.AppDomainAppPath, "App_Data");
    string databaseFile = "StateManagement.mdf";

    CreateSqlDatabaseIfNecessary(path, databaseFile);

    WebSecurity.InitializeDatabaseConnection("DefaultConnection", "Users", "UserId", "UserName", true);
}